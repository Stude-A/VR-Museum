<!DOCTYPE html>
<html>
	<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>VR Plane Museum </title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/v4.1.2/dist/aframe-extras.controls.min.js"></script>

</head>
<body>

    <a-scene>
        
		<a-sky color="#6dafee"></a-sky>
        <a-assets>
          <a-asset-item id="planeModel" src="Modelos/Planes/L1 Plane/11803_Airplane_v1_l1.obj"></a-asset-item>
          <a-asset-item id="planeMaterial" src="Modelos/Planes/L1 Plane/11803_Airplane_v1_l1.mtl"></a-asset-item>
          <a-asset-item id="boldFont" src="https://cdn.aframe.io/fonts/mozillavr.fnt"></a-asset-item>
    
        </a-assets>
         <!-- Cilindro largo debajo del avión -->
    <a-cylinder position="0 -70 -300" radius="60" height="70" color="#FF0000"></a-cylinder>
    
		<!--- Plano de referencia -->
        <a-entity>
          <a-plane position="0 -3 0" rotation="-90 0 0" width="10" height="10" color="#7BC8A4" opacity="0.5"></a-plane>
          <a-entity line="start: -5 0 0; end: 5 0 0; color: #000"></a-entity>

        </a-entity>

        <a-entity id="planeEntity" obj-model="obj: #planeModel; mtl: #planeMaterial" 
          position="0 10 -300" rotation="-110 90 -90" scale="0.1 0.1 0.1" class="clickable"
          animation__fly="property: position; to: 900 240 -300; dur: 4000; easing: linear; startEvents: click"
          animation__disappear="property: visible; to: false; dur: 1.5; startEvents: animationcomplete__fly"
          animation__reappear="property: position; to: -300 0 -300; dur: 1; startEvents: animationcomplete__disappear; property: visible; to: true"
          animation__return="property: position; to: 0 10 -300; dur: 3000; easing: linear; startEvents: animationcomplete__reappear">
</a-entity>

      
        

     

 <!-- Cámara con controles y botones -->
 <a-entity camera look-controls wasd-controls="acceleration: 200">
  <a-cursor></a-cursor>

     <!-- Cuadro de texto con título y descripción -->
     <a-entity position="0 3 -5">
			<!-- Fondo del cuadro de texto -->
			<a-plane position="0 0.5 0" width="4" height="2" color="#FFF" opacity="0.7"></a-plane>
    
			<!-- Título del avión -->
			<a-text value="Airbus 580" color="#000" position="0 0.75 0.01" align="center" width="14" ></a-text>
			
			<!-- Descripción del avión -->
			<a-text value="Largest Commercial plane as it has 4 turbines" color="#000" position="0 0.25 0.01" align="center" width="4"></a-text>
		  </a-entity>

  <!-- Botón de anterior -->
  <a-circle position="-1 1 -2" radius="0.15" color="#4CAF50"
            event-set__mouseenter="_event: mouseenter; color: #3e8e41"
            event-set__mouseleave="_event: mouseleave; color: #4CAF50"
            event-set__click="_event: click; _target: #planeModel; scale: 0.1 0.1 0.1">
    <a-text value="<" align="center" position="0 0 0.1" color="#FFF"></a-text>
  </a-circle>

  <!-- Botón de siguiente -->
  <a-circle position="1 1 -2" radius="0.15" color="#4CAF50"
            event-set__mouseenter="_event: mouseenter; color: #3e8e41"
            event-set__mouseleave="_event: mouseleave; color: #4CAF50"
            event-set__click="_event: click; _target: #planeModel; scale: 0.2 0.2 0.2">
    <a-text value=">" align="center" position="0 0 0.1" color="#FFF"></a-text>
  </a-circle>

   <!-- Botón de restablecer cámara -->
   <a-entity position="-1.5 -1.5 -2">
    <a-plane width=".8" height="0.2" color="#4CAF50" class="clickable"
             event-set__mouseenter="_event: mouseenter; color: #3e8e41"
             event-set__mouseleave="_event: mouseleave; color: #4CAF50"
             event-set__click="_event: click; _target: #camera; _delay: 0; position: 0 0 0; rotation: 0 0 0; radius: 3 ">
      <a-text value="Reset Camera" align="center" position="0 0 0" color="#FFF" width="2"></a-text>
    </a-plane>
  </a-entity>
</a-entity>
    <script>
      // Elemento del avión
const plane = document.querySelector('#planeEntity');

// 1. Comenzar vuelo cuando se hace clic
plane.addEventListener('click', function () {
  this.emit('click'); // Inicia la animación de vuelo
});

// 2. Al completar el vuelo (fly), desaparecer
plane.addEventListener('animationcomplete__fly', function () {
  this.emit('animationcomplete__fly'); // Desaparición
});

// 3. Al completar la desaparición, reaparecer en la esquina inferior izquierda
plane.addEventListener('animationcomplete__disappear', function () {
  this.setAttribute('position', '-500 -200 -300'); // Mover a la esquina
  this.setAttribute('visible', true);          // Hacerlo visible
  this.emit('animationcomplete__disappear');   // Reaparecer
});

// 4. Al reaparecer, regresar a la posición inicial
plane.addEventListener('animationcomplete__reappear', function () {
  this.emit('animationcomplete__reappear'); // Inicia el retorno
});


      
      AFRAME.registerComponent('disable-w-movement', {
        init: function () {
          this.el.addEventListener('componentchanged', this.checkRotation.bind(this));
        },
        checkRotation: function (evt) {
          if (evt.detail.name === 'rotation') {
            const rotation = this.el.getAttribute('rotation');
            if (rotation.x > 45) { // Si la rotación en el eje X es mayor a 45 grados
              this.disableW();
            } else {
              this.enableW();
            }
          }
        },
        disableW: function () {
          document.addEventListener('keydown', this.preventW);
        },
        enableW: function () {
          document.removeEventListener('keydown', this.preventW);
        },
        preventW: function (event) {
          if (event.key === 'w' || event.key === 'W') {
            event.preventDefault();
          }
        }
      });

      document.querySelector('#camera').setAttribute('disable-w-movement', '');
    </script>


      </a-scene>

      
      

	 
</body>
</html>